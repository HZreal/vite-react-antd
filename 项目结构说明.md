# 表格 CRUD 功能实现说明

## 📁 项目目录结构

```
src/
├── api/                          # API 请求层
│   ├── request.ts               # Axios 请求封装（拦截器、错误处理）
│   ├── table.ts                 # 表格相关 API 接口（支持 Mock/真实 API 切换）
│   └── mock.ts                   # Mock 数据服务（开发测试用）
│
├── types/                        # TypeScript 类型定义
│   └── table.ts                 # 表格相关类型（TableDataItem、API 参数等）
│
├── hooks/                        # 自定义 Hooks
│   └── useTable.ts              # 表格数据管理 Hook（封装 CRUD 逻辑）
│
├── utils/                        # 工具函数
│   └── constants.ts             # 常量定义（API 地址、分页配置等）
│
├── components/                   # 通用组件
│   └── TableForm/               # 表格表单组件（新增/编辑弹窗）
│       └── index.tsx
│
└── pages/                        # 页面组件
    └── tables/
        └── myTable.tsx          # 表格页面（完整的 CRUD 功能）
```

## 🎯 核心功能

### 1. 数据展示
- ✅ 表格列表展示（分页）
- ✅ 加载状态显示
- ✅ 空状态处理

### 2. 数据查询
- ✅ 分页查询
- ✅ 筛选功能（姓名筛选）
- ✅ 排序功能（姓名、年龄排序）

### 3. 数据创建
- ✅ 新增按钮
- ✅ 表单弹窗
- ✅ 表单验证
- ✅ 创建成功后刷新列表

### 4. 数据更新
- ✅ 编辑按钮
- ✅ 编辑表单（预填充数据）
- ✅ 更新成功后刷新列表

### 5. 数据删除
- ✅ 单个删除（带确认提示）
- ✅ 批量删除（支持多选）
- ✅ 删除成功后刷新列表

### 6. 其他功能
- ✅ 行选择（checkbox）
- ✅ 操作列固定
- ✅ 响应式布局

## 🔧 技术实现

### API 层 (`src/api/`)

#### `request.ts` - 请求封装
- Axios 实例配置
- 请求拦截器（可添加 token）
- 响应拦截器（统一错误处理）
- 错误提示（使用 Ant Design message）

#### `table.ts` - 业务 API
- 支持 Mock/真实 API 自动切换
- 通过环境变量控制
- 统一的接口定义

#### `mock.ts` - Mock 数据
- 内存数据存储
- 模拟网络延迟
- 完整的 CRUD 操作

### 类型定义 (`src/types/`)

#### `table.ts`
- `TableDataItem`: 表格数据项类型
- `CreateTableDataParams`: 创建参数类型
- `UpdateTableDataParams`: 更新参数类型
- `ApiResponse`: API 响应类型
- `PaginationResponse`: 分页响应类型
- `QueryParams`: 查询参数类型

### Hooks 层 (`src/hooks/`)

#### `useTable.ts` - 表格管理 Hook
封装了：
- 数据加载逻辑
- CRUD 操作方法
- 分页状态管理
- 加载状态管理
- 错误处理

**使用示例：**
```tsx
const { dataSource, loading, pagination, create, update, remove } = useTable();

// 创建数据
await create({ name: '张三', age: 25, address: '北京', tags: ['developer'] });

// 更新数据
await update({ id: 1, name: '李四' });

// 删除数据
await remove(1);
```

### 组件层 (`src/components/`)

#### `TableForm` - 表单组件
- 支持新增/编辑两种模式
- 表单验证
- 自动填充编辑数据
- 提交成功后回调

### 页面层 (`src/pages/tables/`)

#### `myTable.tsx` - 表格页面
- 集成 useTable Hook
- 集成 TableForm 组件
- 完整的 UI 交互
- 操作按钮和确认提示

## 🚀 使用方法

### 1. 开发环境（使用 Mock 数据）

默认使用 Mock 数据，无需配置后端：

```bash
npm run dev
```

### 2. 连接真实后端

创建 `.env` 文件：

```env
VITE_API_BASE_URL=http://localhost:3000/api
VITE_USE_MOCK=false
```

### 3. 后端接口规范

参考 `README_API.md` 文档，确保后端接口符合规范。

## 📝 代码特点

### 1. 目录结构清晰
- 按功能模块划分
- 职责单一原则
- 易于维护和扩展

### 2. 类型安全
- 完整的 TypeScript 类型定义
- 类型推导和检查
- 减少运行时错误

### 3. 可复用性
- Hook 封装业务逻辑
- 组件可复用
- API 层统一管理

### 4. 开发体验
- Mock 数据支持
- 错误提示友好
- 加载状态清晰

### 5. 最佳实践
- 遵循 React Hooks 规范
- 组件化设计
- 关注点分离

## 🔄 扩展指南

### 添加新的 API 模块

1. **创建类型定义** (`src/types/`)
```typescript
// src/types/user.ts
export interface User {
  id: number;
  name: string;
  email: string;
}
```

2. **创建 API 文件** (`src/api/`)
```typescript
// src/api/user.ts
import request from './request';
import type { User } from '../types/user';

export const getUserList = () => request.get<User[]>('/user/list');
```

3. **创建 Hook** (`src/hooks/`)（可选）
```typescript
// src/hooks/useUser.ts
export const useUser = () => {
  // 用户相关逻辑
};
```

4. **在组件中使用**
```tsx
import { getUserList } from '../api/user';

const data = await getUserList();
```

### 添加新的表格列

在 `myTable.tsx` 的 `columns` 数组中添加：

```tsx
{
  title: '新列',
  dataIndex: 'newField',
  key: 'newField',
  render: (value) => <span>{value}</span>
}
```

### 添加搜索功能

1. 在组件中添加搜索输入框
2. 使用 `setQueryParams` 更新查询参数
3. Hook 会自动重新加载数据

```tsx
const [searchValue, setSearchValue] = useState('');

const handleSearch = () => {
  setQueryParams({ name: searchValue, page: 1 });
};
```

## 🐛 常见问题

### 1. Mock 数据不生效？

检查环境变量：
- `VITE_USE_MOCK=true` 或
- 不设置 `VITE_API_BASE_URL`

### 2. 请求失败？

- 检查后端接口是否正常
- 检查 API 地址配置
- 查看浏览器控制台错误信息

### 3. 类型错误？

- 确保后端返回的数据结构符合类型定义
- 检查 `src/types/table.ts` 中的类型定义

## 📚 相关文档

- [API 接口文档](./README_API.md)
- [React 学习指南](./REACT_学习指南.md)

## ✨ 下一步优化建议

1. **搜索功能**：添加姓名、年龄等字段的搜索
2. **导出功能**：支持导出 Excel/CSV
3. **批量操作**：批量编辑、批量导入等
4. **权限控制**：根据用户权限显示/隐藏操作按钮
5. **缓存优化**：使用 React Query 或 SWR 优化数据缓存
6. **单元测试**：添加组件和 Hook 的单元测试


